(function(n){var r={};function i(e){if(r[e]){return r[e].exports}var t=r[e]={i:e,l:false,exports:{}};n[e].call(t.exports,t,t.exports,i);t.l=true;return t.exports}i.m=n;i.c=r;i.d=function(e,t,n){if(!i.o(e,t)){Object.defineProperty(e,t,{enumerable:true,get:n})}};i.r=function(e){if(typeof Symbol!=="undefined"&&Symbol.toStringTag){Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(e,"__esModule",{value:true})};i.t=function(t,e){if(e&1)t=i(t);if(e&8)return t;if(e&4&&typeof t==="object"&&t&&t.__esModule)return t;var n=Object.create(null);i.r(n);Object.defineProperty(n,"default",{enumerable:true,value:t});if(e&2&&typeof t!="string")for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n};i.n=function(t){var e=t&&t.__esModule?function e(){return t["default"]}:function e(){return t};i.d(e,"a",e);return e};i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};i.p="";return i(i.s=0)})([function(e,t){window.addEventListener("load",function(e){var n=document.getElementById("canvas");n.height=999;n.width=999;var t=function(){var o=[];function e(e){o=e}function t(){return o}function n(t,e){o[o.findIndex(function(e){return e.Uuid==t})]=e}function r(t){return o.find(function(e){return e.Uuid==t})}function i(e){var t=e.getContext("2d");t.clearRect(0,0,e.width,e.height);for(var n in o){var r=o[n];var i=parseInt(r.Position/1e4,10);var a=r.Position-i*1e4;i+=Math.round(Math.sin(r.Direction)*r.Speed);a+=Math.round(Math.cos(r.Direction)*r.Speed*-1);if(r.Uuid==g){t.fillStyle="blue"}t.fillRect(i,a,10,10);r.Position=i*1e4+a;o[n]=r;t.fillStyle="black"}}return{getObjects:t,setObject:n,getObject:r,setObjects:e,drawCanvas:i}};var m=t();var r;var i=document.getElementById("output");var a=document.getElementById("type");var o=document.getElementById("input");var u=document.getElementById("status");var p;var g;var c;var s=(new Date).getTime();var y=0;var b=function(e){var t=document.createElement("div");t.innerHTML=e;i.appendChild(t)};document.getElementById("open").onclick=function(e){var t=document.getElementById("address").value;if(p){return false}p=new WebSocket("ws://"+t+"/ws");r=setInterval(function(){m.drawCanvas(n)},100);p.onopen=function(e){b("OPEN")};p.onclose=function(e){b("CLOSE");p=null;clearInterval(c);c=null};p.onmessage=function(e){if(!e.data){return}var t=JSON.parse(e.data);var n=t.Time;switch(t.Action){case"pong":y=s-n;break;case"status":m.setObjects(Object.values(t.Data.Maps.start.Objects));u.innerHTML=Object.values(t.Data.Maps.start.Objects).map(function(e){return"uuid : "+e.Uuid+"<br/> Ap/Dp/Hp : "+e.Ap+"/"+e.Dp+"/"+e.Hp+" pos : "+e.Position+"<br/>"}).join("<br/>");break;case"move":var r=m.getObject(t.Uuid);r.Speed=t.Data.Speed;r.Direction=t.Data.Direction;m.setObject(t.Uuid,r);break;case"login":g=t.Data.Uuid;break}b("RESPONSE: "+e.data)};p.onerror=function(e){b("ERROR: "+e.data)};c=setInterval(l,5e3);return false};document.getElementById("send").onclick=function(e){if(!p){return false}b("SEND: "+o.value);var t={actionType:a.value,value:o.value,time:(new Date).getTime()-y};p.send(JSON.stringify(t));return false};document.getElementById("close").onclick=function(e){if(!p){return false}p.close();clearInterval(r);return false};function l(){if(!p){return}s=(new Date).getTime();var e={actionType:"ping",time:s-y};p.send(JSON.stringify(e))}document.getElementById("left").onclick=function(e){if(!p){return false}b("SEND: left");var t={actionType:"move",value:{Direction:4.7,Speed:1},time:(new Date).getTime()-y};p.send(JSON.stringify(t));return false};document.getElementById("right").onclick=function(e){if(!p){return false}b("SEND: right");var t={actionType:"move",value:{Direction:1.5,Speed:1},time:(new Date).getTime()-y};p.send(JSON.stringify(t));return false};document.getElementById("up").onclick=function(e){if(!p){return false}b("SEND: up");var t={actionType:"move",value:{Direction:0,Speed:1},time:(new Date).getTime()-y};p.send(JSON.stringify(t));return false};document.getElementById("down").onclick=function(e){if(!p){return false}b("SEND: down");var t={actionType:"move",value:{Direction:3.14,Speed:1},time:(new Date).getTime()-y};p.send(JSON.stringify(t));return false};var S;document.getElementById("canvas").onclick=function(e){if(!p){return false}clearTimeout(S);var t=m.getObject(g);var n=parseInt(t.Position/1e4,10);var r=t.Position-n*1e4;var i=e.offsetX;var a=e.offsetY;var o=m.getObjects();for(var u in o){var c=o[u];if(g==c.Uuid){break}var s=parseInt(c.Position/1e4);var l=parseInt(c.Position%1e4);console.log("object:",s,l);if(i>=s&&i<=s+10&&a>=l&&a<=l+10){var f={actionType:"attack",value:{Target:c.Uuid},time:(new Date).getTime()-y};p.send(JSON.stringify(f));return}}var d=Math.sqrt(Math.pow(i-n,2)+Math.pow(a-r,2));var v=(i>=n?1:-1)*Math.acos(-1*(a-r)/d);t.Direction=Math.round(v*100)/100;m.setObject(g,t);b("SEND: move with mouse");var f={actionType:"move",value:{Direction:Math.round(v*100)/100,Speed:3},time:(new Date).getTime()-y};p.send(JSON.stringify(f));S=setTimeout(function(){var e={actionType:"move",value:{Direction:Math.round(v*100)/100,Speed:0},time:(new Date).getTime()-y};p.send(JSON.stringify(e))},d/3*100);return false}})}]);